{
    "attribs": {
        "isActive": "yes",
        "isFolder": "no"
    },
    "type": "script",
    "name": "gained and lost equilibrium",
    "packageName": null,
    "script": "function wsys.gainedb( display_diff )\nwsys.times.bals.got.b = getTime(true, \"HH:mm:ss:zzz\" )\nraiseEvent(\"got balance\")\n--cecho(\"<green>got balance\")\nlocal lost_time = wsys.times.bals.lost.b\nwsys.bals.b = true\nwsys.gotBalanceValue(gmcp.Char.Vitals.bal)\nwsys.lockqueue()\nif wsys.bals.e then\n wsys.refillqueue()\n wsys.canaction()\nend -- if\nwsys.lyrequeue()\n\nif display_diff then\n  local balanceTime = wsys.timeDifference(wsys.times.bals.got.b, lost_time) / 1000\n  cecho(\"<grey> \" .. balanceTime .. \"s\")\nend\nend -- func\n\nfunction wsys.gainede( display_diff )\n wsys.times.bals.got.e = getTime(true, \"HH:mm:ss:zzz\" )\n raiseEvent(\"got equilibrium\")\n wsys.bals.e = true\n local lost_time = wsys.times.bals.lost.e\n wsys.gotEquilibriumValue( gmcp.Char.Vitals.eq )\n if wsys.bals.e and wsys.vmode then wsys.unignoreRestoBreaks() end\n if wsys.bals.b then\n  wsys.lockqueue()\n  wsys.refillqueue()\n  wsys.canaction()\n end -- if\n if wsys.aff.disrupted then wsys.aff.disrupted = nil end\n wsys.lyrequeue()\n\n if display_diff then\n   local eqTime = wsys.timeDifference(wsys.times.bals.got.e, lost_time) / 1000\n   cecho(\"<grey> \" .. eqTime .. \"s\")\n end\n\nend -- func\n\n\nfunction wsys.lostb()\n --cecho(\"<red>lost balance\")\n wsys.times.bals.lost.b = getTime(true, \"HH:mm:ss:zzz\" )\n raiseEvent(\"lost balance\")\nend -- func\n\nfunction wsys.loste()\n wsys.times.bals.lost.e = getTime(true, \"HH:mm:ss:zzz\" )\n raiseEvent(\"lost equilibrium\")\nend -- func\n\nfunction wsys.gotBalanceValue(v)\n  if wsys.bals.b and v == \"0\" then\n    wsys.bals.b = false\n    wsys.lostb()\n  elseif not wsys.bals.b and v == \"1\" then\n    wsys.bals.b = true\n  elseif wsys.bals.b and v == \"1\" then\n    wsys.bals.b = true\n  elseif not wsys.bals.b and v == \"0\" then\n    wsys.bals.b = false\n  end\nend\n\nfunction wsys.gotEquilibriumValue(v)\n  if wsys.bals.e and v == \"0\" then\n    wsys.bals.e = false\n    wsys.loste()\n  elseif not wsys.bals.e and v == \"1\" then\n    wsys.bals.e = true\n  elseif v == \"1\" then\n    wsys.bals.e = true\n  elseif v == \"0\" then\n    wsys.bals.e = false\n  end\nend\n\nfunction wsys.vitalsUpdate()\n  if gmcp.Char.Vitals then\n    wsys.gotEquilibriumValue(gmcp.Char.Vitals.eq)\n    wsys.gotBalanceValue(gmcp.Char.Vitals.bal)\n  end\nend\n\nregisterAnonymousEventHandler(\"gmcp.Char\", \"wsys.vitalsUpdate\")\n\n",
    "eventHandlerList": null
}