{
    "attribs": {
        "isActive": "yes",
        "isFolder": "no"
    },
    "type": "script",
    "name": "gmcp events",
    "packageName": null,
    "script": "function wsys.addedItem()\n  if gmcp.Char.Items.Add.location == \"inv\" then\n    local herbName = wsys.returnHerbName(gmcp.Char.Items.Add.item.name)\n    --cecho(\"<green>Added:\")\n    --display(gmcp.Char.Items.Add)\n    \n    --if item is a herb find amount of herbs\n    if herbName then\n      local herbAmount = wsys.extractNumberFromString(gmcp.Char.Items.Add.item.name) or 1\n      --add amount to herbs already outrifted\n      wsys.herbsout[herbName] = wsys.herbsout[herbName] + herbAmount\n\n      --save the wsys.addedHerbID for a special gmcp case\n      wsys.addedHerbID = tonumber(gmcp.Char.Items.Add.item.id)\n      \n      if wsys.timer.outrqueuewait then killTimer(wsys.timer.outrqueuewait) end\n      wsys.timer.outrqueuewait = tempTimer(wsys.myPing() * 1.5, [[wsys.timer.outrqueuewait = nil;wsys.outrqueue()]])\n    end\n  end\nend --func\n\nregisterAnonymousEventHandler(\"gmcp.Char.Items.Add\", \"wsys.addedItem\")\n\nfunction wsys.removedItem()\n  if gmcp.Char.Items.Remove.location == \"inv\" then\n    local herbName = wsys.returnHerbName(gmcp.Char.Items.Remove.item.name)\n    --cecho(\"<red>Removed:\")\n    --display(gmcp.Char.Items.Remove)\n    \n    --if the item is a herb find amount\n    if herbName then\n      local herbAmount = wsys.extractNumberFromString(gmcp.Char.Items.Remove.item.name) or 1\n      --remove amount from herbs already outrifted\n      wsys.herbsout[herbName] = wsys.herbsout[herbName] - herbAmount\n\n      --save the wsys.removedHerbID for a special gmcp case\n      wsys.removedHerbID = tonumber(gmcp.Char.Items.Remove.item.id)\n\n      --check if you ate from a group of herbs, causing an added and removed event\n      if wsys.removedHerbID == wsys.addedHerbID then\n        --it is the case, remove the extra added\n        wsys.herbsout[herbName] = wsys.herbsout[herbName] - 1\n\n        --change the addedHerbID just in case\n        wsys.addedHerbID = 1\n      end\n\n      --make sure you didn't subtract too many and end up with negative values in wsys.herbsout\n      if wsys.herbsout[herbName] < 0 then\n        wsys.herbsout[herbName] = 0\n      end\n      if not wsys.timer.outrqueuewait then wsys.outrqueue() end\n    end\n  end\nend\n\nregisterAnonymousEventHandler(\"gmcp.Char.Items.Remove\", \"wsys.removedItem\")\n\nfunction wsys.updateItem()\n  if gmcp.Char.Items.Update.location == \"inv\" then\n    --cecho(\"<green>Updated:\")\n    --display(gmcp.Char.Items.Update)\n  end\nend\n\nregisterAnonymousEventHandler(\"gmcp.Char.Items.Update\", \"wsys.updateItem\")",
    "eventHandlerList": null
}