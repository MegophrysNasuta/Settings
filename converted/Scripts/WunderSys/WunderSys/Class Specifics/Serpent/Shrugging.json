{
    "attribs": {
        "isActive": "yes",
        "isFolder": "no"
    },
    "type": "script",
    "name": "Shrugging",
    "packageName": null,
    "script": "--check if you should shrug or not.\n--run this on every aff gain and loss event\nfunction wsys.autoshrugcheck()\n  if wsys.settings.autoshrugging and wsys.isClass(\"serpent\") and wsys.cancure() then\n    local saffs = wsys.shrugAffs()\n    if saffs >= wsys.settings.autoshrugat and not wsys.aff.weariness and wsys.bals.shrugging and not wsys.timer.shrugwait then\n      --queue the shrug here\n      wsys.shrug()\n    elseif saffs < wsys.settings.autoshrugat and wsys.timer.shrugwait then\n      wsys.cancelshrug()\n    end\n  end\nend\n\nregisterAnonymousEventHandler(\"got aff\", \"wsys.autoshrugcheck\")\nregisterAnonymousEventHandler(\"lost aff\", \"wsys.autoshrugcheck\")\n\nwsys.shrugqueue = \"bal\"\n\nfunction wsys.shrug()\n  --triggers for shrugging\n  enableTrigger(\"Shrugged\")\n  --shrugwait timer\n  wsys.timer.shrugwait = tempTimer(5, [[wsys.timer.shrugwait = nil;disableTrigger(\"Shrugged\")]])\n  --queue the shrug\n  wsys.dofreefirst(\"shrugging\")\n  wsys.shrugqueue = wsys.selectDofreeQueue()\n\nend\n\n\nfunction wsys.cancelshrug()\n  --remove 'shrugging' from dofree queue.\n  --we used DOFREEFIRST, it'll always be at #1\n  --so just replace the #1 of rememberedQueue (eq or bal) with nothing!\n  if wsys.timer.shrugwait then\n    --kill the timer and nil it\n    killTimer(tostring(wsys.timer.shrugwait))\n    wsys.timer.shrugwait = nil\n    --disable shrugging triggers\n    disableTrigger(\"Shrugged\")\n    --remove from queue via hold breath\n    send(\"queue replace \" .. wsys.shrugqueue .. \" 1 hold breath\")\n  end\n\nend\n\nlocal shrugprompt = false\n\nfunction wsys.shrugged()\n  if wsys.timer.shrugwait and not wsys.lifevision then\n    wsys.cure = \"shrugging\"\n    killTimer(tostring(wsys.timer.shrugwait))\n    wsys.timer.shrugwait = nil\n    wsys.lostBal(\"shrugging\", 10.5)\n    if shrugprompt then killTrigger(tostring(shrugprompt)) end\n    shrugprompt = tempLineTrigger(1, 1, [[if isPrompt() then wsys.emptyshrug() end]])\n    disableTrigger(\"Shrugged\")\n  end\nend\n\n\nfunction wsys.emptyshrug()\n  if wsys.timer.shrugwait then\n    disableTrigger(\"Shrug\")\n    killTimer(tostring(wsys.timer.shrugwait))\n    wsys.timer.shrugwait = nil\n    for k,v in pairs(wsys.tb.cures.shrugging) do\n      if wsysf.affs[v] then\n        wsysf.core.debug.print(2, \"Empty shrug should clear \".. v..\"?\")\n      end\n      disableTrigger(string.title(v) .. \" -\")\n    end\n  end\nend\n\nfunction wsys.shrugbalgained()\n  wsys.gotBal(\"shrugging\")\n  wsys.lockqueue()\nend\n\nfunction wsys.shruggedoffbal()\n  if wsys.timer.shrugwait then killTimer(tostring(wsys.timer.shrugwait)) end\n  wsys.timer.shrugwait = nil\n  wsys.lostBal(\"shrugging\", 10)\nend\n\nfunction wsys.shrugfail()\n  if wsys.timer.shrugwait then\n    killTimer(tostring(wsys.timer.shrugwait))\n    wsys.timer.shrugwait = nil\n    wsys.affadd(\"weariness\")\n  end\nend\n\n\nfunction wsys.shrugAffs()\n  local c = 0\n\n  if wsys.aff.addiction then c = c + 1 end\n  if wsys.aff.agoraphobia then c = c + 1 end\n  if wsys.aff.anorexia then c = c + 1 end\n  if wsys.aff.asthma then c = c + 1 end\n  if wsys.aff.carm then c = c + 1 end\n  if wsys.aff.claustrophobia then c = c + 1 end\n  if wsys.aff.cleg then c = c + 1 end\n  if wsys.aff.clumsiness then c = c + 1 end\n  if wsys.aff.confusion then c = c + 1 end\n  if wsys.aff.brokenrightleg then c = c + 1 end\n  if wsys.aff.darkshade then c = c + 1 end\n  if wsys.aff.dissonance then c = c + 1 end\n  if wsys.aff.dizziness then c = c + 1 end\n  if wsys.aff.epilepsy then c = c + 1 end\n  if wsys.aff.generosity then c = c + 1 end\n  if wsys.aff.haemophilia then c = c + 1 end\n  if wsys.aff.hallucinations then c = c + 1 end\n  if wsys.aff.healthleech then c = c + 1 end\n  if wsys.aff.hypersomnia then c = c + 1 end\n  if wsys.aff.hypochondria then c = c + 1 end\n  if wsys.aff.impatience then c = c + 1 end\n  if wsys.aff.lethargy then c = c + 1 end\n  if wsys.aff.loneliness then c = c + 1 end\n  if wsys.aff.lovers then c = c + 1 end\n  if wsys.aff.justice then c = c + 1 end\n  if wsys.aff.manaleech then c = c + 1 end\n  if wsys.aff.masochism then c = c + 1 end\n  if wsys.aff.nausea then c = c + 1 end\n  if wsys.aff.pacified then c = c + 1 end\n  if wsys.aff.paralysis then c = c + 1 end\n  if wsys.aff.paranoia then c = c + 1 end\n  if wsys.aff.peace then c = c + 1 end\n  if wsys.aff.recklessness then c = c + 1 end\n  if wsys.aff.scytherus then c = c + 1 end\n  if wsys.aff.sensitivity then c = c + 1 end\n  if wsys.aff.shivering then c = c + 1 end\n  if wsys.aff.shyness then c = c + 1 end\n  if wsys.aff.slickness then c = c + 1 end\n  if wsys.aff.stupidity then c = c + 1 end\n  if wsys.aff.vertigo then c = c + 1 end\n\n  return c\nend\n\n\n\n",
    "eventHandlerList": null
}