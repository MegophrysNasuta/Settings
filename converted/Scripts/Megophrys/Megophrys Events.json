{
    "attribs": {
        "isActive": "yes",
        "isFolder": "no"
    },
    "type": "script",
    "name": "Megophrys Events",
    "packageName": null,
    "script": "Megophrys.onDisconnect = function()\n  disableTrigger('Update Power Bars')\nend\n\nMegophrys.onConnect = function()\n  sendGMCP([[Core.Supports.Add [\"IRE.Time 1\"] ]])\n  registerAnonymousEventHandler('gmcp.Char.Items.List', 'Megophrys.updateWhatHere')\n  registerAnonymousEventHandler('gmcp.Char.Items.Add', 'Megophrys.updateWhatHere')\n  registerAnonymousEventHandler('gmcp.Char.Items.Remove', 'Megophrys.updateWhatHere')\n  registerAnonymousEventHandler('gmcp.Char.Items.Update', 'Megophrys.updateWhatHere')\n  registerAnonymousEventHandler('gmcp.Room.Players', 'Megophrys.updateWhoHere')\n  registerAnonymousEventHandler('gmcp.Room.AddPlayer', 'Megophrys.updateWhoHere')\n  registerAnonymousEventHandler('gmcp.Room.RemovePlayer', 'Megophrys.updateWhoHere')\n  registerAnonymousEventHandler('gmcp.IRE.Time.Update', 'Megophrys.showTime')\n  registerAnonymousEventHandler('sysGetHttpDone', 'Megophrys.updateWhosOnline')\n  wsys.unkeepup('shield')\n  wsys.unkeepup('reflections')\n  wsys.setSettings('automount', 'on')\n  mmp.settings:setOption('gallop', true)\n  mmp.settings:setOption('dash', false)\n  Megophrys.class = gmcp.Char.Status.class\n  Megophrys.makeClassToolbars()\n  supportedClass = Megophrys[Megophrys.class]\n  if supportedClass then\n    supportedClass.onConnect()\n    supportedClass.makeClassToolbars()\n  end\n  Megophrys.setMode('denizen')\n  Megophrys.resetCuringPrios()\n  enableTrigger('Update Power Bars')\n  cecho('\\n<cyan>Megophrys v1.1 initialised. Enjoy :)\\n')\nend\n\nMegophrys.endSpeedwalk = function()\n  local endingPursuit = Megophrys.inPursuit\n  Megophrys.inPursuit = false\n  Megophrys.priorityLabel:echo('<center>Priority: IDLE</center>')\n  if Megophrys.class == 'Magi' then\n    sendAll('land', 'golem return')\n  end\n  if Megophrys.killStrat == 'raid' and Megophrys.raidLeader then\n    send('fol '.. Megophrys.raidLeader)\n  elseif Megophrys.killStrat == 'bonk' then\n    if endingPursuit then send('psi transcend') end\n  elseif Megophrys.killStrat == 'pummel' then\n    if endingPursuit then send('embed focus') end\n    if Megophrys.autoEscaping then\n      if Megophrys.opponentClass and Megophrys.opponentClass == 'airlord' then\n        Megophrys.autoResist()\n      else\n        send('cast aerial')\n      end\n    else\n      send('fol '.. target)\n      Megophrys.autoAttack()\n    end\n  end\n  if Megophrys.autoEscaping then\n    Megophrys.stopEscape('Safe')\n  end\nend\nregisterAnonymousEventHandler('mmapper arrived', 'Megophrys.endSpeedwalk')\n\nMegophrys.flyingBlocked = function()\n  if Megophrys.autoEscaping and Megophrys.class == 'Magi' then\n    Megophrys.stopEscape('Can\\'t fly -- trying barrier')\n    Megophrys.autoResist()\n  end\nend\n\nMegophrys.flyingSuccess = function()\n  if Megophrys.autoEscaping then\n    Megophrys.stopEscape('Flying (done)')\n    Megophrys.autoResist()\n  end\nend\n\nMegophrys.gainedBalance = function()\n  if gmcp.Char.Vitals.bal ~= \"1\" then return end\n  if Megophrys.autoAttacking then\n    Megophrys[Megophrys.class].nextAttack()\n  end\nend\n\nMegophrys.gainedEQ = function()\n  if gmcp.Char.Vitals.eq ~= \"1\" then return end\n  if Megophrys.autoAttacking then\n    Megophrys[Megophrys.class].nextAttack()\n  end\nend\n\nMegophrys.hitWall = function()\n  if speedWalkDir[1] then\n    sendAll('mj '.. speedWalkDir[1], 'leap '.. speedWalkDir[1])\n  elseif Megophrys.lastDirTried then\n    sendAll('mj '.. Megophrys.lastDirTried, 'leap '.. Megophrys.lastDirTried)\n  end\nend\n\nMegophrys.hitParry = function()\n  cecho('\\n<cyan>TARGETED STRIKE PARRIED!\\n')\n  if matches[2] == target and Megophrys.autoAttacking and not Megophrys.targetTorso then\n    Megophrys.toggleTargetLimb()\n    cecho('\\n<cyan>Switching to '.. Megophrys.targetLimb ..' leg due to parry.')\n  end\nend\n\nMegophrys.hitRebounding = function()\n  if Megophrys.class == 'Magi' then\n    Megophrys.Magi.element = 'air'\n    cecho('\\n<cyan>Switching to air for rebounding\\n')\n  end\n  cecho('\\n<cyan>STOP HITTING YOURSELF STOP HITTING YOURSELF\\n')\nend\n\nMegophrys.hitShield = function()\n  if not Megophrys.autoAttacking or Megophrys.killStrat ~= 'denizen' then\n    return\n  end\n\n  brage_dshield = {\n    Alchemist='throw caustic at ',\n    Blademaster='shin shatter ',\n    Magi='cast disintegrate on ',\n    Psion='weave pulverise ',\n  }\n\n  if brage_dshield[Megophrys.class] then\n    send(brage_dshield[Megophrys.class] .. target)\n  end\nend\n\nMegophrys.underPressure = function()\n  if Megophrys.autoEscaping then\n    Megophrys.stopEscape('Blocked by pressure')\n    Megophrys.autoResist()\n  end\nend\n",
    "eventHandlerList": null
}