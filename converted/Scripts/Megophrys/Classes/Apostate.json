{
    "attribs": {
        "isActive": "yes",
        "isFolder": "no"
    },
    "type": "script",
    "name": "Apostate",
    "packageName": null,
    "script": "Megophrys.Apostate = (Megophrys.Apostate or {})\nlocal Apostate = Megophrys.Apostate\n\nApostate.doSpecial = function() send('demon corrupt &tar') end\n\nMegophrys.Apostate.makeClassToolbars = function()\n  Megophrys.aposToolbar = Geyser.Container:new({\n    name='apos_toolbar',\n    x=270, y=0, width=270, height=60\n  })\n\n  Apostate.summonLabel = Geyser.Label:new({\n    name='summon_label',\n    x=0, y=0, width=100, height=20,\n    message='Summon:'\n  }, Megophrys.aposToolbar)\n  Apostate.summonLabel:setFontSize(11)\n  Apostate.summonButton = Geyser.Label:new({\n    name='summon',\n    x=100, y=20, width=170, height=20,\n  }, Megophrys.aposToolbar)\n  Apostate.summonButton:setFontSize(11)\n\n  Apostate.nextEyesLabel = Geyser.Label:new({\n    name='next_eyes_label',\n    x=0, y=20, width=100, height=20,\n    message='Next stare: '\n  }, Megophrys.aposToolbar)\n  Apostate.nextEyesLabel:setFontSize(11)\n  Apostate.nextEyesButton = Geyser.Label:new({\n    name='next_eyes',\n    x=100, y=20, width=170, height=20,\n  }, Megophrys.aposToolbar)\n  Apostate.nextEyesButton:setFontSize(11)\n\n  Apostate.setMode('denizen')\n  Megophrys.updatePrepGauges()\nend\n\nMegophrys.Apostate.onConnect = function()\n  sendAll(\n    'unwield all',\n    'remove armour',\n    'put armour in pack370332'\n  )\n  tempTimer(3, Megophrys.Apostate.gearUp)\nend\n\nMegophrys.Apostate.gearUp = function()\n  send('wield shield268649 right')\nend\n\nMegophrys.Apostate.nextAttack = function()\n  local Apostate = Megophrys.Apostate\n  local chanceToMouthOff = 0\n  local imSoClever = ''\n  local killStrat = Megophrys.killStrat\n  local targetAffs = affstrack.score\n  local targetHits = Megophrys.targetHits or 0\n  local uiColor = Megophrys.fgColors[killStrat]\n\n  local tarAff = affstrack.score\n\n  local setNextAttack = 'setalias nextAttack '\n  if killStrat ~= 'denizen' then\n    setNextAttack = setNextAttack .. 'order fiend attack &tar / contemplate &tar / '\n  end\n  if not wsys.aff.stupidity then\n    setNextAttack = setNextAttack .. 'stand / '\n  end\n\n  local firstAff = nil\n  local secondAff = nil\n  if killStrat == 'denizen' then\n    setNextAttack = (setNextAttack .. 'stare &tar convulsions / '..\n                                      'daegger burrow &tar / '..\n                                      'decay &tar / ')\n    Megophrys.nextMoveButton:echo('IDK', Megophrys.fgColors[killStrat], 'c')\n  else\n    local chooseAff = function(ignoreAff)\n      local affPrios = {\n        paralysis = 'sicken',         -- eat bloodroot\n        impatience = 'impatience',    -- eat goldenseal\n        asthma = 'asthma',            -- eat kelp\n        manaleech = 'sicken',         -- smoke valerian\n        clumsiness = 'clumsy',        -- eat kelp\n        sensitivity = 'sensitivity',  -- eat kelp\n        slickness = 'sicken',         -- smoke valerian, eat bloodroot\n        nausea = 'vomiting',          -- eat ginseng\n        anorexia = 'anorexia',        -- apply epidermal\n        haemophilia = 'bleed',        -- eat ginseng\n        recklessness = 'reckless',    -- eat lobelia, focus\n        stupidity = 'stupid',         -- eat goldenseal\n        weariness = 'weariness',      -- eat kelp\n      }\n      for aff, humour in pairs(affPrios) do\n        if ignoreAff ~= aff and tarAff[aff] < 80 then return aff end\n      end\n    end\n\n    if ak.defs.curseward then\n      firstAff = 'breach'\n      secondAff = ''\n    else\n      firstAff = chooseAff()\n      secondAff = chooseAff(firstAff)\n    end\n\n    imSoClever = 'warcry'\n    chanceToMouthOff = 0.1\n  end\n\n  local targetIsLocked = (\n    tarAff[\"paralysis\"] > 80 and tarAff[\"anorexia\"] > 80 and tarAff[\"asthma\"] > 80 and\n    tarAff[\"slickness\"] > 80 and tarAff[\"impatience\"] > 80\n  )\n\n  if targetIsLocked then\n    firstAff = 'plague'\n    secondAff = 'sicken'\n  end\n\n  local targetManaPct = (ak.currentmana or 0) / (ak.maxmana or 1)\n  if targetManaPct <= 0.5 then\n    setNextAttack = setNextAttack ..' / demon catharsis &tar'\n    imSoClever = 'Liberated! Your soul is liberated!'\n    chanceToMouthOff = 0.85\n  else\n    table.insert(Megophrys.givingAffs, firstAff)\n    if firstAff then\n      if not secondAff then\n        setNextAttack = setNextAttack ..' / stare &tar '.. firstAff\n      else\n        setNextAttack = (setNextAttack ..' / deadeyes &tar '..\n                         firstAff ..' '.. secondAff)\n        table.insert(Megophrys.givingAffs, secondAff)\n      end\n      Apostate.nextEyesButton:echo(firstAff ..' '.. secondAff, uiColor, 'c')\n    end\n  end\n\n  if wsys.aff.prone then\n    send('stand')\n  else\n    if imSoClever ~= '' and math.random() < chanceToMouthOff then\n      setNextAttack = setNextAttack ..' / '.. imSoClever\n    end\n  end\n\n  sendAll(setNextAttack, 'queue addclear eqbal nextAttack')\n  if not ak.defs.shield then\n    Megophrys.targetHits = targetHits + 1\n  end\n\n  if killStrat ~= 'denizen' then\n    if #Megophrys.givingAffs == 1 then\n      send('pt '.. Megophrys.givingAffs[1] ..' on '.. target)\n    elseif #Megophrys.givingAffs == 2 then\n      send('pt '.. Megophrys.givingAffs[1] ..' and '.. Megophrys.givingAffs[2] ..\n           ' on '.. target)\n    elseif #Megophrys.givingAffs == 3 then\n      send('pt '.. Megophrys.givingAffs[1] ..', '.. Megophrys.givingAffs[2] ..\n           ' and '.. Megophrys.givingAffs[3] ..' on '.. target)\n    end\n  end\nend\n\nMegophrys.Apostate.setMode = function()\n  local Apostate = Megophrys.Apostate\n  local killStrat = Megophrys.killStrat\n\n  Apostate.resetHumourButtonStyles()\n\n  if killStrat == 'denizen' then\n    Megophrys.nextMoveButton:echo('IDK', Megophrys.fgColors[killStrat], 'c')\n  else\n    Megophrys.nextMoveButton:echo('Deadeyes', Megophrys.fgColors[killStrat], 'c')\n  end\n\n  Megophrys.specialMoveButton:echo(\n    'Demon Corrupt',\n    Megophrys.fgColors[killStrat],\n    'c'\n  )\nend\n",
    "eventHandlerList": null
}